<html><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SCP:RP Staff Shift Tracker</title>
    <link rel="stylesheet" href="staff/staff.css">
  </head>
  <body data-bm="55" data-page-key="eventcommittee">
    <script>
      (async () => {
        const token = sessionStorage.getItem("discord_access_token");
        const pageKey = document.body.dataset.pageKey; // "eventcommittee"
        
          
        if (!token) {
          // Send to login with pageKey
          window.location.href = `/.netlify/functions/login?pageKey=${encodeURIComponent(pageKey)}`;
          return;
        }
          
        try {
          const res = await fetch(`/.netlify/functions/verify?pageKey=${encodeURIComponent(pageKey)}`, {
            headers: { Authorization: `Bearer ${token}` }
          });
            
          const data = await res.json();
          
          
          
          if (!data.verified) {
            window.location.href = "/redirect.html";
          } else {
            if (data.username && data.highestRole) {
              document.getElementById("staffname").textContent =
              `Welcome, ${data.username}. Your highest role is: ${data.highestRole}`;
            } else {
              if (data.username && !data.highestRole) {
                document.getElementById("staffname").textContent =
                `Welcome, ${data.username}.`;
              } else {
                document.getElementById("staffname").textContent =
                `Welcome, Event Committee Member.`;
              }
            }
          }
          // else: stay on page
        } catch (err) {
          console.error("Verification error", err);
          window.location.href = "/redirect.html";
        }
      })();
    </script>
    <header>
      <h1>Event Committee | Activity Tracker</h1>
      <div class="">
        <p id="staffname"></p>
      </div>
    </header>

    <div class="card">
      <h2>This section is in development!</h2>
      <div class="bar"></div>
      <label>Coming soon.</label>
    </div>
    <div class="footer">Created by <strong>Choppovm</strong> for Area-55</div>
  </body>
</html>
