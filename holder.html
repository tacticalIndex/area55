<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SCP:RP Staff Shift Tracker</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #121821;
      --panel-2: #0f141b;
      --text: #e6edf3;
      --muted: #9aa4af;
      --accent: #e63946;
      --ok: #2ea043;
      --warn: #e3b341;
      --border: #263041;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 24px;
      font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 800px at 10% 0%, #0d141c 0, var(--bg) 50%);
    }

    header {
      text-align: center;
      margin-bottom: 16px;
    }

    h1 {
      margin: 0 0 6px;
      font-weight: 800;
      letter-spacing: 0.5px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      max-width: 1000px;
      margin: 0 auto;
    }

    @media (min-width: 920px) {
      .grid {
        grid-template-columns: 1.1fr 0.9fr;
      }
    }

    .card {
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
    }

    .card h2 {
      margin: 0 0 10px;
      font-size: 1.1rem;
      letter-spacing: .3px;
    }

    label {
      display: block;
      font-size: 0.9rem;
      color: var(--muted);
      margin: 10px 0 6px;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #0e1520;
      color: var(--text);
      outline: none;
      transition: border .15s ease;
    }

    .row {
      display: flex;
      gap: 10px;
    }

    .row > * {
      flex: 1;
    }

    .timer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      background: #0e141d;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
    }

    .time {
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 2rem;
      letter-spacing: .5px;
    }

    .btns {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    button {
      border: 1px solid var(--border);
      background: #132030;
      color: var(--text);
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
    }

    button.primary {
      background: #17314b;
      border-color: #25496b;
    }

    button.success {
      background: #12321f;
      border-color: #225f39;
    }

    button.warn {
      background: #3a2c12;
      border-color: #72581d;
    }

    button.danger {
      background: #3b161a;
      border-color: #6a272d;
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    .stamp {
      font-size: .9rem;
      color: var(--muted);
    }

    .paste-slot {
      border: 1px dashed #3a4a63;
      border-radius: 12px;
      padding: 12px;
      background: #0c121a;
      position: relative;
    }

    .slot-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .slot-title {
      font-weight: 700;
    }

    .slot-actions {
      display: flex;
      gap: 8px;
    }

    .slot-body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 180px;
      background: #0b1118;
      border-radius: 10px;
      overflow: hidden;
    }

    .slot-body.empty::after {
      content: 'Click this area, then press Ctrl+V to paste a screenshot OR use Paste button';
      color: #7b8796;
      font-size: .95rem;
      text-align: center;
      padding: 12px;
      max-width: 460px;
    }

    canvas {
      max-width: 100%;
      height: auto;
      display: block;
    }

    .footer {
      text-align: center;
      color: var(--muted);
      margin-top: 20px;
      font-size: .9rem;
    }

    .bar {
      height: 3px;
      background: linear-gradient(90deg, var(--accent), transparent);
      border-radius: 999px;
      margin: 10px 0 16px;
      opacity: .5;
    }

    .note {
      background: #131a25;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      color: var(--muted);
      font-size: .9rem;
    }
  </style>
</head>
<body>
  <!-- header -->
  <header>
    <h1>In-Game Staff Shift Tracker</h1>
    <div>Created by tactical_index for the SCP: Roleplay custom server Area-55</div>
  </header>

  <div class="grid">
    <!-- Left side -->
    <section class="card">
      <h2>Staff Details</h2>
      <div class="bar"></div>

      <label>Roblox Username</label>
      <input id="roblox" placeholder="Exact Roblox username" />

      <label>Discord Username</label>
      <input id="discord" placeholder="e.g. user#0001" />

      <label>Staff Codename</label>
      <input id="codename" placeholder="e.g. 'User'" />

      <label>Staff Team</label>
      <form id="shift-form">
        <select id="team">
          <option value="NONE">=== SELECT STAFF TEAM ===</option>
          <option value="SERVERSTARTUPDEPARTMENT">Server Startup Department</option>
          <option value="GAMEMODERATIONTEAM">Game Moderation Team</option>
          <option value="ACTINGDEPARTMENT">Acting Department</option>
          <option value="EVENTCOMMITTEE">Event Committee</option>
          <option value="MORPHINGDEPARTMENT">Morphing Department</option>
        </select>

        <div class="btns" style="margin-top:8px;">
          <button type="submit" class="primary">Send</button>
          <label id="status">Status</label>
        </div>
      </form>

      <h2>Stopwatch</h2>
      <div class="bar"></div>

      <div class="timer">
        <div>
          <div class="time" id="time">00:00:00</div>
          <div class="stamp" id="stamps">Start: — · End: —</div>
        </div>

        <div class="btns">
          <button id="startBtn" class="primary">Start</button>
          <button id="pauseBtn" class="warn" disabled>Pause</button>
          <button id="resumeBtn" class="primary" disabled>Resume</button>
          <button id="endBtn" class="success" disabled>End Shift</button>
          <button id="resetBtn" class="danger" disabled>Reset</button>
        </div>
      </div>
    </section>

    <!-- Right side -->
    <section class="card">
      <h2>Shift Screenshots</h2>
      <div class="bar"></div>

      <div class="paste-slot" id="slotStart">
        <div class="slot-head">
          <div class="slot-title">Start Screenshot</div>
          <div class="slot-actions">
            <button data-paste="start">Paste</button>
            <button data-clear="start">Clear</button>
          </div>
        </div>
        <div class="slot-body empty" tabindex="0">
          <canvas id="canvasStart"></canvas>
        </div>
      </div>

      <div class="paste-slot" id="slotEnd" style="margin-top:12px;">
        <div class="slot-head">
          <div class="slot-title">End Screenshot</div>
          <div class="slot-actions">
            <button data-paste="end">Paste</button>
            <button data-clear="end">Clear</button>
          </div>
        </div>
        <div class="slot-body empty" tabindex="0">
          <canvas id="canvasEnd"></canvas>
        </div>
      </div>
    </section>
  </div>

  <div class="footer">
    Created by <b>tactical_index</b> | Open-source
  </div>

  <script>
    // stopwatch
    let startTime, timerInterval;
    const timeEl = document.getElementById("time");
    const stampsEl = document.getElementById("stamps");

    function updateTime() {
      const elapsed = Date.now() - startTime;
      const hrs = String(Math.floor(elapsed / 3600000)).padStart(2, "0");
      const mins = String(Math.floor((elapsed % 3600000) / 60000)).padStart(2, "0");
      const secs = String(Math.floor((elapsed % 60000) / 1000)).padStart(2, "0");
      timeEl.textContent = `${hrs}:${mins}:${secs}`;
    }

    document.getElementById("startBtn").onclick = () => {
      startTime = Date.now();
      timerInterval = setInterval(updateTime, 1000);
      stampsEl.textContent = `Start: ${new Date().toLocaleTimeString()} · End: —`;
      toggleButtons("start");
    };

    document.getElementById("pauseBtn").onclick = () => {
      clearInterval(timerInterval);
      toggleButtons("pause");
    };

    document.getElementById("resumeBtn").onclick = () => {
      startTime = Date.now() - (parseInt(timeEl.textContent.split(":")[0]) * 3600000 +
        parseInt(timeEl.textContent.split(":")[1]) * 60000 +
        parseInt(timeEl.textContent.split(":")[2]) * 1000);
      timerInterval = setInterval(updateTime, 1000);
      toggleButtons("resume");
    };

    document.getElementById("endBtn").onclick = () => {
      clearInterval(timerInterval);
      stampsEl.textContent = stampsEl.textContent.replace("End: —", `End: ${new Date().toLocaleTimeString()}`);
      toggleButtons("end");
    };

    document.getElementById("resetBtn").onclick = () => {
      clearInterval(timerInterval);
      timeEl.textContent = "00:00:00";
      stampsEl.textContent = "Start: — · End: —";
      toggleButtons("reset");
    };

    function toggleButtons(state) {
      document.getElementById("startBtn").disabled = state !== "reset";
      document.getElementById("pauseBtn").disabled = state !== "start" && state !== "resume";
      document.getElementById("resumeBtn").disabled = state !== "pause";
      document.getElementById("endBtn").disabled = state === "reset";
      document.getElementById("resetBtn").disabled = state === "reset";
    }

    // screenshot paste slots
    const slotStart = { canvas: document.getElementById("canvasStart"), blob: null };
    const slotEnd = { canvas: document.getElementById("canvasEnd"), blob: null };

    function handlePaste(e, slot) {
      const items = e.clipboardData.items;
      for (const item of items) {
        if (item.type.startsWith("image/")) {
          const file = item.getAsFile();
          const ctx = slot.canvas.getContext("2d");
          const img = new Image();
          img.onload = () => {
            slot.canvas.width = img.width;
            slot.canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            slot.blob = file;
            slot.canvas.parentElement.classList.remove("empty");
          };
          img.src = URL.createObjectURL(file);
        }
      }
    }

    document.querySelectorAll(".slot-body").forEach((el, idx) => {
      el.addEventListener("paste", (e) => {
        handlePaste(e, idx === 0 ? slotStart : slotEnd);
      });
    });

    document.querySelectorAll("[data-paste]").forEach((btn) => {
      btn.onclick = async () => {
        try {
          const clipboardItems = await navigator.clipboard.read();
          for (const item of clipboardItems) {
            if (item.types.includes("image/png")) {
              const blob = await item.getType("image/png");
              const slot = btn.dataset.paste === "start" ? slotStart : slotEnd;
              const ctx = slot.canvas.getContext("2d");
              const img = new Image();
              img.onload = () => {
                slot.canvas.width = img.width;
                slot.canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                slot.blob = blob;
                slot.canvas.parentElement.classList.remove("empty");
              };
              img.src = URL.createObjectURL(blob);
            }
          }
        } catch {
          alert("Clipboard paste failed");
        }
      };
    });

    document.querySelectorAll("[data-clear]").forEach((btn) => {
      btn.onclick = () => {
        const slot = btn.dataset.clear === "start" ? slotStart : slotEnd;
        const ctx = slot.canvas.getContext("2d");
        ctx.clearRect(0, 0, slot.canvas.width, slot.canvas.height);
        slot.blob = null;
        slot.canvas.parentElement.classList.add("empty");
      };
    });

    // build shift lines
    function buildShiftLines() {
      const roblox = document.getElementById("roblox").value || "—";
      const discord = document.getElementById("discord").value || "—";
      const codename = document.getElementById("codename").value || "—";
      const stamps = stampsEl.textContent;

      return [
        `**Roblox:** ${roblox}`,
        `**Discord:** ${discord}`,
        `**Codename:** ${codename}`,
        `**Shift:** ${stamps}`,
      ];
    }

    function getBase64FromCanvas(slot) {
      if (!slot.blob) return null;
      return slot.canvas.toDataURL("image/png").split(",")[1];
    }

    // submit handler
    document.getElementById("shift-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const team = document.getElementById("team").value;
      const statusDiv = document.getElementById("status");
      const sendBtn = e.target.querySelector("button[type=submit]");

      sendBtn.disabled = true;
      sendBtn.textContent = "Sending...";

      const description = buildShiftLines().join("\n");
      const payload = {
        embeds: [{
          title: "Shift Report",
          description: description
        }],
        username: "Shift Tracker Bot"
      };

      const body = {
        team,
        payload,
        startImage: getBase64FromCanvas(slotStart),
        endImage: getBase64FromCanvas(slotEnd)
      };

      try {
        const response = await fetch("/.netlify/functions/proxy", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });

        if (response.ok) {
          statusDiv.textContent = "✅ Message sent!";
          statusDiv.style.color = "lightgreen";
        } else {
          const err = await response.text();
          statusDiv.textContent = `❌ Error: ${err}`;
          statusDiv.style.color = "salmon";
        }
      } catch (error) {
        statusDiv.textContent = `⚠️ Failed: ${error.message}`;
        statusDiv.style.color = "salmon";
      }

      sendBtn.disabled = false;
      sendBtn.textContent = "Send";
    });
  </script>
</body>
</html>